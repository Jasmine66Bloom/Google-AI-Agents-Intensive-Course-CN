# ç¬¬4å¤© - ä»£ç†å¯è§‚æµ‹æ€§å’Œè¯„ä¼°

æ­¤æ–‡ä»¶å¤¹åŒ…å«åŸºäº Kaggle 5å¤©ä»£ç†è¯¾ç¨‹çš„ç¬¬4å¤© Jupyter ç¬”è®°æœ¬çš„ Python è„šæœ¬ã€‚

## è„šæœ¬æ¦‚è¿°

### 1. `day_4a_agent_observability.py`
**ä»£ç†å¯è§‚æµ‹æ€§ - æ—¥å¿—ã€è¿½è¸ªå’ŒæŒ‡æ ‡**

æ­¤è„šæœ¬æ¼”ç¤ºï¼š
- ç†è§£ä»£ç†å¯è§‚æµ‹æ€§æ”¯æŸ±ï¼ˆæ—¥å¿—ã€è¿½è¸ªã€æŒ‡æ ‡ï¼‰
- ä½¿ç”¨å¸¦æœ‰ DEBUG æ—¥å¿—è®°å½•çš„ ADK Web UI è°ƒè¯•ä»£ç†
- é€šè¿‡æ—¥å¿—åˆ†æè¯†åˆ«å’Œä¿®å¤é”™è¯¯
- å®ç° LoggingPlugin ç”¨äºç”Ÿäº§å¯è§‚æµ‹æ€§
- åˆ›å»ºè‡ªå®šä¹‰æ’ä»¶å’Œå›è°ƒä»¥è¿›è¡Œä¸“é—¨ç›‘æ§

**å…³é”®æ¦‚å¿µï¼š**
- **æ—¥å¿—**ï¼šæ˜¾ç¤ºå‘ç”Ÿå†…å®¹çš„å•ä¸ªäº‹ä»¶è®°å½•
- **è¿½è¸ª**ï¼šæ˜¾ç¤ºæ•´ä¸ªå†³ç­–åºåˆ—çš„è¿æ¥æ—¥å¿—
- **æŒ‡æ ‡**ï¼šæ˜¾ç¤ºæ•´ä½“æ€§èƒ½çš„æ±‡æ€»ç»Ÿè®¡
- **DEBUG æ—¥å¿—è®°å½•**ï¼šLLM è¯·æ±‚/å“åº”çš„è¯¦ç»†æ£€æŸ¥
- **æ’ä»¶**ï¼šæŒ‚é’©åˆ°ä»£ç†ç”Ÿå‘½å‘¨æœŸçš„è‡ªå®šä¹‰ä»£ç æ¨¡å—
- **å›è°ƒ**ï¼šåœ¨ç‰¹å®šä»£ç†æ‰§è¡Œç‚¹è¿è¡Œçš„å‡½æ•°

**ç¤ºä¾‹ç”¨ä¾‹ï¼š**
- åœ¨å¼€å‘ä¸­è°ƒè¯•ç¥ç§˜çš„ä»£ç†å¤±è´¥
- ä½¿ç”¨è‡ªåŠ¨æ—¥å¿—æ•è·çš„ç”Ÿäº§ç›‘æ§
- ä½¿ç”¨è‡ªå®šä¹‰æŒ‡æ ‡çš„æ€§èƒ½è·Ÿè¸ª
- åˆè§„æ€§å’Œå®¡è®¡è·Ÿè¸ªç”Ÿæˆ

### 2. `day_4b_agent_evaluation.py`
**ä»£ç†è¯„ä¼° - æµ‹è¯•å’Œå›å½’æ£€æµ‹**

æ­¤è„šæœ¬æ¼”ç¤ºï¼š
- åœ¨ ADK Web UI ä¸­äº¤äº’å¼åˆ›å»ºæµ‹è¯•ç”¨ä¾‹
- ä½¿ç”¨ `adk eval` CLI è¿è¡Œç³»ç»Ÿæ€§è¯„ä¼°
- ç†è§£è¯„ä¼°æŒ‡æ ‡ï¼ˆresponse_match å’Œ tool_trajectoryï¼‰
- åˆ›å»ºè¯„ä¼°é…ç½®æ–‡ä»¶
- åˆ†æè¯„ä¼°ç»“æœå¹¶ä¿®å¤é—®é¢˜
- é«˜çº§ç”¨æˆ·æ¨¡æ‹Ÿæ¦‚å¿µ

**å…³é”®æ¦‚å¿µï¼š**
- **è¯„ä¼°**ï¼šè·¨åœºæ™¯å¯¹ä»£ç†æ€§èƒ½è¿›è¡Œç³»ç»Ÿæ€§æµ‹è¯•
- **æµ‹è¯•ç”¨ä¾‹**ï¼šé¢„æœŸè¾“å…¥ã€è¾“å‡ºå’Œå·¥å…·ä½¿ç”¨æ¨¡å¼
- **response_match_score**ï¼šå®é™…å“åº”ä¸é¢„æœŸå“åº”ä¹‹é—´çš„æ–‡æœ¬ç›¸ä¼¼åº¦
- **tool_trajectory_avg_score**ï¼šå·¥å…·è°ƒç”¨å’Œå‚æ•°çš„æ­£ç¡®æ€§
- **å›å½’æµ‹è¯•**ï¼šç¡®ä¿æ–°æ›´æ”¹ä¸ä¼šç ´åç°æœ‰åŠŸèƒ½
- **ç”¨æˆ·æ¨¡æ‹Ÿ**ï¼šä½¿ç”¨ LLM é©±åŠ¨çš„ç”¨æˆ·è¡Œä¸ºè¿›è¡ŒåŠ¨æ€æµ‹è¯•ç”Ÿæˆ

**ç¤ºä¾‹ç”¨ä¾‹ï¼š**
- éƒ¨ç½²å‰çš„ä¸»åŠ¨è´¨é‡ä¿è¯
- CI/CD ç®¡é“ä¸­çš„è‡ªåŠ¨åŒ–å›å½’æµ‹è¯•
- éšæ—¶é—´æµ‹é‡ä»£ç†æ€§èƒ½æ”¹è¿›
- ä½¿ç”¨ç”¨æˆ·æ¨¡æ‹Ÿå‘ç°è¾¹ç¼˜æƒ…å†µ

## å…ˆå†³æ¡ä»¶

ç¡®ä¿æ‚¨å·²å®Œæˆé¡¹ç›®æ ¹ç›®å½•çš„è®¾ç½®ï¼š

```bash
# ä»é¡¹ç›®æ ¹ç›®å½•
source venv/bin/activate  # æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
```

å¦‚æœæ‚¨å°šæœªè®¾ç½®é¡¹ç›®ï¼Œè¯·è¿è¡Œï¼š

```bash
cd ..  # è½¬åˆ°é¡¹ç›®æ ¹ç›®å½•
./setup.sh
source venv/bin/activate
```

## è¿è¡Œè„šæœ¬

### è¿è¡Œè„šæœ¬ 4aï¼ˆå¯è§‚æµ‹æ€§ï¼‰

```bash
# ç¡®ä¿æ‚¨åœ¨ Day-4 ç›®å½•ä¸­å¹¶ä¸” venv å·²æ¿€æ´»
python day_4a_agent_observability.py
```

**å®ƒçš„ä½œç”¨ï¼š**
1. **æ¼”ç¤º1 - ç ´åçš„ä»£ç†**ï¼šå±•ç¤ºå¦‚ä½•é€šè¿‡è°ƒè¯•è¯†åˆ«é”™è¯¯
   - åˆ›å»ºä¸€ä¸ªå¸¦æœ‰æ•…æ„ç±»å‹é”™è¯¯çš„ä»£ç†
   - è§£é‡Šå¦‚ä½•ä½¿ç”¨ ADK Web UI è¿›è¡Œäº¤äº’å¼è°ƒè¯•
   - æ¼”ç¤ºé€šè¿‡è¿½è¸ªåˆ†ææŸ¥æ‰¾é”™è¯¯

2. **æ¼”ç¤º2 - LoggingPlugin**ï¼šå®ç°ç”Ÿäº§å¯è§‚æµ‹æ€§
   - è¿è¡Œç ”ç©¶è®ºæ–‡æŸ¥æ‰¾ä»£ç†
   - è‡ªåŠ¨æ•è·æ‰€æœ‰ä»£ç†æ´»åŠ¨
   - æ¼”ç¤ºå…¨é¢çš„æ—¥å¿—è®°å½•è¾“å‡º

3. **æ¼”ç¤º3 - è‡ªå®šä¹‰æ’ä»¶**ï¼šåˆ›å»ºä¸“é—¨ç›‘æ§
   - å®ç° CountInvocationPlugin
   - è·Ÿè¸ªä»£ç†è°ƒç”¨å’Œ LLM è¯·æ±‚
   - å±•ç¤ºå¦‚ä½•æ„å»ºè‡ªå®šä¹‰å¯è§‚æµ‹æ€§

### è¿è¡Œè„šæœ¬ 4bï¼ˆè¯„ä¼°ï¼‰

```bash
python day_4b_agent_evaluation.py
```

**å®ƒçš„ä½œç”¨ï¼š**
1. **æ¼”ç¤º1 - äº¤äº’å¼è¯„ä¼°**ï¼šè§£é‡Š ADK Web UI å·¥ä½œæµç¨‹
   - å¦‚ä½•ä»å¯¹è¯åˆ›å»ºæµ‹è¯•ç”¨ä¾‹
   - è¿è¡Œè¯„ä¼°å¹¶æŸ¥çœ‹ç»“æœ
   - ç†è§£é€šè¿‡/å¤±è´¥æ ‡å‡†

2. **æ¼”ç¤º2 - ç³»ç»Ÿæ€§è¯„ä¼°**ï¼šè®¾ç½® CLI è¯„ä¼°
   - åˆ›å»ºè¯„ä¼°é…ç½®æ–‡ä»¶
   - ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹æ–‡ä»¶
   - è§£é‡Š `adk eval` å‘½ä»¤ç”¨æ³•

3. **æ¼”ç¤º3 - ç”¨æˆ·æ¨¡æ‹Ÿ**ï¼šæ¶µç›–é«˜çº§æµ‹è¯•
   - åŠ¨æ€æµ‹è¯•ç”Ÿæˆæ¦‚å¿µ
   - ConversationScenario æ¨¡å¼
   - ç›¸å¯¹äºé™æ€æµ‹è¯•ç”¨ä¾‹çš„å¥½å¤„

4. **æ¼”ç¤º4 - æœ€ä½³å®è·µ**ï¼šåˆ†äº«è¯„ä¼°ç­–ç•¥
   - æ„å»ºå…¨é¢çš„æµ‹è¯•å¥—ä»¶
   - è®¾ç½®é€‚å½“çš„é˜ˆå€¼
   - ç”Ÿäº§è¯„ä¼°å·¥ä½œæµç¨‹

## ç†è§£è¾“å‡º

### ç¬¬4å¤©a è¾“å‡ºï¼ˆå¯è§‚æµ‹æ€§ï¼‰

**ç ´åçš„ä»£ç†æ¼”ç¤ºï¼š**
```
ğŸ› æ­¤ä»£ç†åœ¨ count_papers å·¥å…·ä¸­æœ‰æ•…æ„é”™è¯¯
è¯¥å·¥å…·æœŸæœ› 'str' ä½†åº”è¯¥æ¥å— 'List[str]'

ğŸ‘‰ åœ¨å®é™…åœºæ™¯ä¸­ï¼Œæ‚¨å°†ï¼š
   1. è¿è¡Œ 'adk web --log_level DEBUG' å¯åŠ¨ Web UI
   2. ä½¿ç”¨ä»¥ä¸‹å†…å®¹æµ‹è¯•ä»£ç†ï¼š'æŸ¥æ‰¾æœ€æ–°çš„é‡å­è®¡ç®—è®ºæ–‡'
   3. ä½¿ç”¨äº‹ä»¶é€‰é¡¹å¡å’Œè¿½è¸ªæŸ¥æ‰¾é”™è¯¯
   4. æŸ¥çœ‹ function_call ä»¥æŸ¥çœ‹ä¸æ­£ç¡®çš„å‚æ•°ç±»å‹
```

**LoggingPlugin æ¼”ç¤ºï¼š**
```
ğŸš€ ä½¿ç”¨ LoggingPlugin è¿è¡Œä»£ç†...
ğŸ“Š è§‚çœ‹å…¨é¢çš„æ—¥å¿—è®°å½•è¾“å‡ºï¼š

INFO: å‘é€è¯·æ±‚ï¼Œæ¨¡å‹ï¼šgemini-2.5-flash-lite
INFO: æ”¶åˆ°æ¨¡å‹çš„å“åº”
INFO: è°ƒç”¨å·¥å…·ï¼šgoogle_search
INFO: å“åº”ï¼š[ä»£ç†å“åº”]

âœ… ä»£ç†æ‰§è¡Œå®Œæˆï¼
â€¢ LoggingPlugin è‡ªåŠ¨æ•è·äº†æ‰€æœ‰ä»£ç†æ´»åŠ¨
â€¢ æ£€æŸ¥ logger.log æ–‡ä»¶ä»¥è·å–è¯¦ç»†çš„ DEBUG æ—¥å¿—
```

**è‡ªå®šä¹‰æ’ä»¶æ¼”ç¤ºï¼š**
```
[CountPlugin] ä»£ç†è°ƒç”¨ #1
[CountPlugin] LLM è¯·æ±‚ #1
[CountPlugin] LLM è¯·æ±‚ #2

ğŸ“Š è‡ªå®šä¹‰æ’ä»¶ç»Ÿè®¡ï¼š
   â€¢ ä»£ç†è°ƒç”¨ï¼š1
   â€¢ LLM è¯·æ±‚ï¼š2
ğŸ’¡ è‡ªå®šä¹‰æ’ä»¶å…è®¸æ‚¨æ·»åŠ ä»»ä½•æ‚¨éœ€è¦çš„å¯è§‚æµ‹æ€§é€»è¾‘ï¼
```

### ç¬¬4å¤©b è¾“å‡ºï¼ˆè¯„ä¼°ï¼‰

**äº¤äº’å¼è¯„ä¼°ï¼š**
```
ğŸ“ äº¤äº’å¼è¯„ä¼°å·¥ä½œæµç¨‹ï¼š
1ï¸âƒ£  åˆ›å»ºæµ‹è¯•ç”¨ä¾‹ï¼š
   â€¢ å¯åŠ¨ ADK Web UIï¼šadk web
   â€¢ ä¸æ‚¨çš„ä»£ç†è¿›è¡Œå¯¹è¯
   â€¢ å¯¼èˆªåˆ°"è¯„ä¼°"é€‰é¡¹å¡
   â€¢ åˆ›å»ºè¯„ä¼°é›†å¹¶æ·»åŠ å½“å‰ä¼šè¯

2ï¸âƒ£  è¿è¡Œè¯„ä¼°ï¼š
   â€¢ æ£€æŸ¥æ‚¨çš„æµ‹è¯•ç”¨ä¾‹
   â€¢ ç‚¹å‡»"è¿è¡Œè¯„ä¼°"æŒ‰é’®
   â€¢ æŸ¥çœ‹æŒ‡æ ‡å¹¶å¼€å§‹è¯„ä¼°

3ï¸âƒ£  åˆ†æç»“æœï¼š
   â€¢ ç»¿è‰²"é€šè¿‡"ï¼šä»£ç†è¡Œä¸ºç¬¦åˆé¢„æœŸ
   â€¢ çº¢è‰²"å¤±è´¥"ï¼šä»£ç†åç¦»é¢„æœŸè¡Œä¸º
```

**CLI è¯„ä¼°ï¼š**
```
âœ… è¯„ä¼°é…ç½®å·²åˆ›å»ºï¼
ğŸ“Š è¯„ä¼°æ ‡å‡†ï¼š
â€¢ tool_trajectory_avg_scoreï¼š1.0 - éœ€è¦ç²¾ç¡®çš„å·¥å…·ä½¿ç”¨åŒ¹é…
â€¢ response_match_scoreï¼š0.8 - éœ€è¦ 80% çš„æ–‡æœ¬ç›¸ä¼¼åº¦

âœ… è¯„ä¼°æµ‹è¯•ç”¨ä¾‹å·²åˆ›å»º
ğŸ§ª æµ‹è¯•åœºæ™¯ï¼š
â€¢ living_room_light_onï¼šè¯·æ‰“å¼€å®¢å…çš„è½åœ°ç¯...
â€¢ kitchen_on_off_sequenceï¼šæ‰“å¼€å¨æˆ¿çš„ä¸»ç¯...

ğŸš€ è¿è¡Œæ­¤å‘½ä»¤ä»¥æ‰§è¡Œè¯„ä¼°ï¼š
   adk eval home_automation_agent integration.evalset.json \
     --config_file_path=test_config.json \
     --print_detailed_results
```

## å…³é”®æ¨¡å¼å’Œä½•æ—¶ä½¿ç”¨å®ƒä»¬

### å¯è§‚æµ‹æ€§æ–¹æ³•

| æ–¹æ³• | ä½•æ—¶ä½¿ç”¨ | æœ€é€‚åˆ |
|----------|-------------|----------|
| **adk web --log_level DEBUG** | å¼€å‘è°ƒè¯• | äº¤äº’å¼é—®é¢˜è§£å†³ |
| **LoggingPlugin()** | ç”Ÿäº§ç›‘æ§ | æ ‡å‡†å¯è§‚æµ‹æ€§éœ€æ±‚ |
| **è‡ªå®šä¹‰æ’ä»¶** | ç‰¹æ®Šéœ€æ±‚ | ç‰¹å®šé¢†åŸŸæŒ‡æ ‡ã€åˆè§„æ€§ |

### è¯„ä¼°ç­–ç•¥

| ç­–ç•¥ | ä½•æ—¶ä½¿ç”¨ | æœ€é€‚åˆ |
|----------|-------------|----------|
| **äº¤äº’å¼ï¼ˆWeb UIï¼‰** | å¼€å‘è¿­ä»£ | å¿«é€Ÿåé¦ˆã€æµ‹è¯•åˆ›å»º |
| **CLIï¼ˆadk evalï¼‰** | ç³»ç»Ÿæ€§æµ‹è¯• | å›å½’æµ‹è¯•ã€CI/CD |
| **ç”¨æˆ·æ¨¡æ‹Ÿ** | å…¨é¢è¦†ç›– | è¾¹ç¼˜æƒ…å†µå‘ç° |

## å¯è§‚æµ‹æ€§æ·±å…¥æ¢è®¨

### æ—¥å¿—çº§åˆ«

```python
--log_level DEBUG  # å®Œæ•´çš„ LLM æç¤ºã€å“åº”ã€å†…éƒ¨çŠ¶æ€
--log_level INFO   # ä»£ç†æ“ä½œã€å·¥å…·è°ƒç”¨ï¼ˆé»˜è®¤ï¼‰
--log_level WARNING  # æ½œåœ¨é—®é¢˜
--log_level ERROR  # å¤±è´¥å’Œå¼‚å¸¸
```

**ä½•æ—¶ä½¿ç”¨æ¯ä¸ªçº§åˆ«ï¼š**
- **DEBUG**ï¼šå¼€å‘ã€è°ƒè¯•ç¥ç§˜å¤±è´¥
- **INFO**ï¼šç”Ÿäº§ç›‘æ§ã€ä¸€èˆ¬æ“ä½œè·Ÿè¸ª
- **WARNING**ï¼šå¼‚å¸¸è­¦æŠ¥
- **ERROR**ï¼šå…³é”®å¤±è´¥è·Ÿè¸ª

### ç†è§£è¿½è¸ª

è¿½è¸ªæ˜¾ç¤ºå®Œæ•´çš„æ‰§è¡Œæµç¨‹ï¼š

```
ç”¨æˆ·æŸ¥è¯¢
  â†“
è°ƒç”¨ root_agent
  â†“
  è°ƒç”¨ google_search_agent
    â†“
    æ‰§è¡Œå·¥å…·ï¼šgoogle_search
    â†“
    LLM å¤„ç†ç»“æœ
  â†“
  è°ƒç”¨ count_papers å·¥å…·
  â†“
  LLM ç”Ÿæˆæœ€ç»ˆå“åº”
â†“
è¿”å›ç»™ç”¨æˆ·
```

**å¥½å¤„ï¼š**
- è¯†åˆ«ç“¶é¢ˆï¼ˆå“ªä¸ªæ­¥éª¤è€—æ—¶æœ€é•¿ï¼Ÿï¼‰
- ç†è§£å†³ç­–æµç¨‹ï¼ˆä»£ç†ä¸ºä»€ä¹ˆé€‰æ‹©è¿™æ¡è·¯å¾„ï¼Ÿï¼‰
- è°ƒè¯•å·¥å…·ä½¿ç”¨ï¼ˆè°ƒç”¨äº†å“ªäº›å·¥å…·ä»¥åŠä½•æ—¶è°ƒç”¨ï¼Ÿï¼‰

### è‡ªå®šä¹‰æ’ä»¶æ¨¡æ¿

```python
from google.adk.plugins.base_plugin import BasePlugin
from google.adk.agents.callback_context import CallbackContext

class MyCustomPlugin(BasePlugin):
    def __init__(self):
        super().__init__(name="my_custom_plugin")
        # æ‚¨çš„åˆå§‹åŒ–

    async def before_agent_callback(self, *, agent, callback_context):
        # åœ¨ä»£ç†å¯åŠ¨ä¹‹å‰è¿è¡Œ
        pass

    async def after_agent_callback(self, *, agent, callback_context):
        # åœ¨ä»£ç†å®Œæˆä¹‹åè¿è¡Œ
        pass

    async def before_tool_callback(self, *, tool, callback_context):
        # åœ¨ä»»ä½•å·¥å…·è°ƒç”¨ä¹‹å‰è¿è¡Œ
        pass

    async def before_model_callback(self, *, callback_context, llm_request):
        # åœ¨ LLM è¯·æ±‚ä¹‹å‰è¿è¡Œ
        pass

    async def on_model_error_callback(self, *, callback_context, error):
        # å½“ LLM é”™è¯¯å‘ç”Ÿæ—¶è¿è¡Œ
        pass
```

**ç”¨ä¾‹ï¼š**
- æ€§èƒ½è®¡æ—¶
- æˆæœ¬è·Ÿè¸ªï¼ˆä»¤ç‰Œä½¿ç”¨ï¼‰
- å®‰å…¨å®¡è®¡
- è‡ªå®šä¹‰æŒ‡æ ‡æ”¶é›†

## è¯„ä¼°æ·±å…¥æ¢è®¨

### è¯„ä¼°æ–‡ä»¶ç»“æ„

**1. test_config.json**ï¼ˆå¯é€‰ - å®šä¹‰é˜ˆå€¼ï¼‰
```json
{
  "criteria": {
    "tool_trajectory_avg_score": 1.0,
    "response_match_score": 0.8
  }
}
```

**2. integration.evalset.json**ï¼ˆå¿…éœ€ - æµ‹è¯•ç”¨ä¾‹ï¼‰
```json
{
  "eval_set_id": "my_test_suite",
  "eval_cases": [
    {
      "eval_id": "test_case_1",
      "conversation": [
        {
          "user_content": {"parts": [{"text": "ç”¨æˆ·æŸ¥è¯¢"}]},
          "final_response": {"parts": [{"text": "é¢„æœŸå“åº”"}]},
          "intermediate_data": {
            "tool_uses": [
              {
                "name": "tool_name",
                "args": {"param": "value"}
              }
            ]
          }
        }
      ]
    }
  ]
}
```

### è¯„ä¼°æŒ‡æ ‡è§£é‡Š

**response_match_scoreï¼š**
- ä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦ç­‰ç®—æ³•æµ‹é‡æ–‡æœ¬ç›¸ä¼¼åº¦
- èŒƒå›´ï¼š0.0ï¼ˆå®Œå…¨ä¸åŒï¼‰åˆ° 1.0ï¼ˆç›¸åŒï¼‰
- è€ƒè™‘è¯­ä¹‰å«ä¹‰ï¼Œè€Œä¸ä»…ä»…æ˜¯ç²¾ç¡®çš„å•è¯åŒ¹é…

```
é¢„æœŸï¼š"ç¯ç°åœ¨å·²æ‰“å¼€"
å®é™…ï¼š"æˆ‘å·²ç»æ‰“å¼€äº†ç¯"
åˆ†æ•°ï¼š0.85ï¼ˆå°½ç®¡æªè¾ä¸åŒï¼Œä½†ç›¸ä¼¼åº¦å¾ˆé«˜ï¼‰
```

**tool_trajectory_avg_scoreï¼š**
- æ£€æŸ¥æ˜¯å¦ä½¿ç”¨æ­£ç¡®çš„å·¥å…·å’Œæ­£ç¡®çš„å‚æ•°
- èŒƒå›´ï¼š0.0ï¼ˆé”™è¯¯çš„å·¥å…·ï¼‰åˆ° 1.0ï¼ˆå®Œç¾åŒ¹é…ï¼‰
- éªŒè¯å·¥å…·é€‰æ‹©å’Œå‚æ•°å€¼

```
é¢„æœŸï¼šset_device_status(location="kitchen", device_id="light", status="ON")
å®é™…ï¼šset_device_status(location="kitchen", device_id="light", status="ON")
åˆ†æ•°ï¼š1.0ï¼ˆå®Œç¾åŒ¹é…ï¼‰
```

### ä» Web UI åˆ›å»ºæµ‹è¯•ç”¨ä¾‹

**åˆ†æ­¥æ“ä½œï¼š**
1. å¯åŠ¨ ADK Web UIï¼š`adk web`
2. ä»ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹©æ‚¨çš„ä»£ç†
3. è¿›è¡Œæ­£å¸¸å¯¹è¯
4. ç‚¹å‡»å³ä¾§é¢æ¿ä¸­çš„"è¯„ä¼°"é€‰é¡¹å¡
5. ç‚¹å‡»"åˆ›å»ºè¯„ä¼°é›†"
6. å‘½åæ‚¨çš„è¯„ä¼°é›†ï¼ˆä¾‹å¦‚ï¼Œ"happy_path_tests"ï¼‰
7. ç‚¹å‡»è¯„ä¼°é›†æ—è¾¹çš„">"ç®­å¤´
8. ç‚¹å‡»"æ·»åŠ å½“å‰ä¼šè¯"
9. ç»™æµ‹è¯•ç”¨ä¾‹å‘½å
10. æ–‡ä»¶è‡ªåŠ¨åœ¨ `.adk/eval_sets/` ä¸­åˆ›å»º

**å¥½å¤„ï¼š**
- æ— éœ€æ‰‹åŠ¨ç¼–å†™ JSON
- æ•è·çœŸå®çš„å¯¹è¯æµç¨‹
- è‡ªåŠ¨åŒ…å«å·¥å…·è°ƒç”¨
- æ˜“äºè¿­ä»£

### è¿è¡Œ CLI è¯„ä¼°

```bash
# åŸºæœ¬è¯„ä¼°
adk eval <agent_dir> <evalset.json>

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®
adk eval <agent_dir> <evalset.json> --config_file_path=<config.json>

# ä½¿ç”¨è¯¦ç»†è¾“å‡º
adk eval <agent_dir> <evalset.json> --print_detailed_results

# ç¤ºä¾‹
adk eval home_automation_agent integration.evalset.json \
  --config_file_path=test_config.json \
  --print_detailed_results
```

**è¾“å‡ºåŒ…æ‹¬ï¼š**
- æ¯ä¸ªæµ‹è¯•çš„é€šè¿‡/å¤±è´¥æ‘˜è¦
- å„ä¸ªæŒ‡æ ‡åˆ†æ•°
- å®é™…ä¸é¢„æœŸæ¯”è¾ƒè¡¨
- å¤±è´¥çš„è¯¦ç»†å·®å¼‚

## å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### å¯è§‚æµ‹æ€§é—®é¢˜

#### é—®é¢˜ï¼šçœ‹ä¸åˆ° DEBUG æ—¥å¿—
**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥æ—¥å¿—çº§åˆ«ï¼šä½¿ç”¨ `--log_level DEBUG`
- éªŒè¯æ—¥å¿—æ–‡ä»¶ä½ç½®ï¼š`cat logger.log`
- ç¡®ä¿åœ¨ä»£ç†è¿è¡Œä¹‹å‰é…ç½®äº†æ—¥å¿—è®°å½•

#### é—®é¢˜ï¼šæ—¥å¿—å¤ªå†—é•¿
**è§£å†³æ–¹æ¡ˆï¼š**
- ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ INFO çº§åˆ«ï¼š`--log_level INFO`
- ä½¿ç”¨ grep è¿‡æ»¤æ—¥å¿—ï¼š`cat logger.log | grep ERROR`
- å®ç°å¸¦æœ‰é€‰æ‹©æ€§æ—¥å¿—è®°å½•çš„è‡ªå®šä¹‰æ’ä»¶

#### é—®é¢˜ï¼šæ— æ³•è®¿é—® ADK Web UI
**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥ç«¯å£ 8000 æ˜¯å¦å¯ç”¨
- éªŒè¯ï¼š`adk web` å‘½ä»¤æ­£åœ¨è¿è¡Œ
- æœ¬åœ°è®¿é—®ï¼šhttp://127.0.0.1:8000
- å¯¹äº Kaggleï¼šä½¿ç”¨ä»£ç† URL å¸®åŠ©ç¨‹åº

### è¯„ä¼°é—®é¢˜

#### é—®é¢˜ï¼šæ‰€æœ‰æµ‹è¯•å› ä½ response_match_score è€Œå¤±è´¥
**è§£å†³æ–¹æ¡ˆï¼š**
- ä»£ç†å“åº”æ ¼å¼å·²æ›´æ”¹
- æ›´æ–°è¯„ä¼°é›†ä¸­çš„é¢„æœŸå“åº”
- æˆ–é™ä½é…ç½®ä¸­çš„é˜ˆå€¼ï¼ˆä¾‹å¦‚ï¼Œ0.7 è€Œä¸æ˜¯ 0.8ï¼‰

```json
{
  "criteria": {
    "response_match_score": 0.7  // é™ä½é˜ˆå€¼
  }
}
```

#### é—®é¢˜ï¼štool_trajectory_avg_score å§‹ç»ˆä¸º 0.0
**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥é¢„æœŸä¸å®é™…ä¸­çš„å‚æ•°é¡ºåº
- éªŒè¯å·¥å…·åç§°å®Œå…¨åŒ¹é…ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰
- ç¡®ä¿å‚æ•°ç±»å‹åŒ¹é…ï¼ˆå­—ç¬¦ä¸²ä¸æ•°å­—ï¼‰

```json
// ä¸æ­£ç¡® - å‚æ•°é¡ºåºé”™è¯¯
"args": {"status": "ON", "location": "kitchen"}

// æ­£ç¡® - å¿…é¡»åŒ¹é…å®é™…è°ƒç”¨é¡ºåº
"args": {"location": "kitchen", "status": "ON"}
```

#### é—®é¢˜ï¼šæ‰¾ä¸åˆ° evalset æ–‡ä»¶
**è§£å†³æ–¹æ¡ˆï¼š**
- ä½¿ç”¨ç»å¯¹è·¯å¾„æˆ–æ­£ç¡®çš„ç›¸å¯¹è·¯å¾„
- æ£€æŸ¥æ–‡ä»¶æ‰©å±•åæ˜¯ `.evalset.json`
- éªŒè¯æ–‡ä»¶åœ¨æŒ‡å®šä½ç½®

```bash
# å¦‚æœæ–‡ä»¶åœ¨ä»£ç†ç›®å½•ä¸­
adk eval my_agent my_agent/tests.evalset.json

# å¦‚æœæ–‡ä»¶åœ¨å½“å‰ç›®å½•ä¸­
adk eval my_agent ./tests.evalset.json
```

#### é—®é¢˜ï¼šä»£ç†è¡Œä¸ºæ˜¯ä¸ç¡®å®šçš„ï¼Œæµ‹è¯•ä¸ç¨³å®š
**è§£å†³æ–¹æ¡ˆï¼š**
- è®¾ç½® temperature=0 ä»¥è·å¾—ç¡®å®šæ€§å“åº”
- å¢åŠ  response_match_score é˜ˆå€¼å®¹å·®
- ä¸“æ³¨äº tool_trajectoryï¼ˆæ¯”æ–‡æœ¬æ›´ç¨³å®šï¼‰

```python
model=Gemini(
    model="gemini-2.5-flash-lite",
    generation_config={"temperature": 0}  // ç¡®å®šæ€§
)
```

## æœ€ä½³å®è·µ

### å¯è§‚æµ‹æ€§æœ€ä½³å®è·µ

1. **å¼€å‘é˜¶æ®µ**
   ```bash
   # å¤§é‡ä½¿ç”¨ DEBUG æ—¥å¿—è®°å½•
   adk web --log_level DEBUG

   # é¢‘ç¹æ£€æŸ¥æ—¥å¿—
   tail -f logger.log
   ```

2. **ç”Ÿäº§é˜¶æ®µ**
   ```python
   # ä½¿ç”¨ LoggingPlugin è¿›è¡Œè‡ªåŠ¨æ•è·
   runner = InMemoryRunner(
       agent=agent,
       plugins=[LoggingPlugin()]
   )
   ```

3. **è‡ªå®šä¹‰ç›‘æ§**
   ```python
   # è·Ÿè¸ªç‰¹å®šé¢†åŸŸæŒ‡æ ‡
   class CostTrackingPlugin(BasePlugin):
       async def after_model_callback(self, *, callback_context, llm_response):
           tokens = llm_response.usage_metadata.total_token_count
           self.total_cost += tokens * COST_PER_TOKEN
   ```

### è¯„ä¼°æœ€ä½³å®è·µ

1. **æ„å»ºå…¨é¢çš„æµ‹è¯•å¥—ä»¶**
   ```
   test_suite/
   â”œâ”€â”€ happy_path.evalset.json       # åŸºæœ¬åŠŸèƒ½
   â”œâ”€â”€ edge_cases.evalset.json       # å¼‚å¸¸è¾“å…¥
   â”œâ”€â”€ error_handling.evalset.json   # æ— æ•ˆè¯·æ±‚
   â””â”€â”€ multi_turn.evalset.json       # å¤æ‚å¯¹è¯
   ```

2. **è®¾ç½®ç°å®çš„é˜ˆå€¼**
   ```json
   {
     "criteria": {
       // å…³é”®æ“ä½œ - éœ€è¦å®Œç¾
       "tool_trajectory_avg_score": 1.0,

       // æ²Ÿé€š - å…è®¸ä¸€äº›çµæ´»æ€§
       "response_match_score": 0.75
     }
   }
   ```

3. **è¿­ä»£å¤±è´¥**
   ```bash
   # 1. è¿è¡Œè¯„ä¼°
   adk eval agent tests.evalset.json --print_detailed_results

   # 2. åˆ†æå¤±è´¥
   # æŸ¥çœ‹å®é™…ä¸é¢„æœŸçš„å·®å¼‚

   # 3. ä¿®å¤ä»£ç†æˆ–æ›´æ–°æµ‹è¯•é¢„æœŸ

   # 4. é‡æ–°è¿è¡Œä»¥éªŒè¯
   adk eval agent tests.evalset.json
   ```

4. **CI/CD é›†æˆ**
   ```yaml
   # .github/workflows/test.yml
   - name: è¿è¡Œä»£ç†è¯„ä¼°
     run: |
       adk eval my_agent tests/integration.evalset.json \
         --config_file_path=tests/config.json
   ```

5. **éšæ—¶é—´è·Ÿè¸ªæŒ‡æ ‡**
   ```python
   # å­˜å‚¨è¯„ä¼°ç»“æœ
   timestamp = datetime.now().isoformat()
   results_file = f"eval_results/{timestamp}.json"

   # ç»˜åˆ¶è¶‹åŠ¿
   # å“åº”è´¨é‡æ˜¯å¦æœ‰æ‰€æ”¹å–„ï¼Ÿ
   # å·¥å…·è°ƒç”¨æ˜¯å¦æ›´å‡†ç¡®ï¼Ÿ
   ```

## é«˜çº§ä¸»é¢˜

### ç”¨æˆ·æ¨¡æ‹Ÿ

**ConversationScenario ç»“æ„ï¼š**
```json
{
  "user_goal": "é¢„è®¢é£å¾€å·´é»çš„èˆªç­",
  "conversation_plan": [
    "è¯¢é—®å¯ç”¨èˆªç­",
    "è¯¢é—®ä»·æ ¼",
    "è¯·æ±‚ç‰¹å®šçš„å‡ºå‘æ—¶é—´",
    "å®Œæˆé¢„è®¢"
  ]
}
```

**å¥½å¤„ï¼š**
- å‘ç°æ‚¨æ²¡æœ‰æƒ³åˆ°çš„è¾¹ç¼˜æƒ…å†µ
- æµ‹è¯•ä»£ç†é€‚åº”æ€§
- æ¯”é™æ€æµ‹è¯•æ›´çœŸå®
- è‡ªåŠ¨åŒ–æµ‹è¯•ç”Ÿæˆ

**äº†è§£æ›´å¤šï¼š** [ADK ç”¨æˆ·æ¨¡æ‹Ÿæ–‡æ¡£](https://google.github.io/adk-docs/evaluate/user-sim/)

### é«˜çº§è¯„ä¼°æ ‡å‡†

**ä½¿ç”¨ Google Cloud å‡­æ®ï¼š**
```json
{
  "criteria": {
    "safety_v1": 0.9,          // æ£€æµ‹æœ‰å®³å†…å®¹
    "hallucinations_v1": 0.85,  // æ£€æŸ¥äº‹å®å‡†ç¡®æ€§
    "custom_metric": 0.8        // æ‚¨çš„è‡ªå®šä¹‰è¯„ä¼°å™¨
  }
}
```

**äº†è§£æ›´å¤šï¼š** [Vertex AI è¯„ä¼°æ ‡å‡†](https://docs.cloud.google.com/vertex-ai/generative-ai/docs/models/determine-eval)

## è°ƒè¯•å·¥ä½œæµç¨‹

### å®Œæ•´è°ƒè¯•è¿‡ç¨‹

1. **è§‚å¯Ÿç—‡çŠ¶**
   ```
   ç”¨æˆ·ï¼š"æŸ¥æ‰¾å…³äº AI çš„è®ºæ–‡"
   ä»£ç†ï¼š"æˆ‘æ— æ³•å¸®åŠ©æ‚¨"
   ```

2. **æ£€æŸ¥æ—¥å¿—**
   ```bash
   cat logger.log | grep ERROR
   # æˆ–ä½¿ç”¨å¸¦æœ‰ DEBUG çš„ adk web
   ```

3. **åˆ†æè¿½è¸ª**
   - å°è¯•äº†å“ªäº›å·¥å…·ï¼Ÿ
   - å‘é€äº†å“ªäº› LLM æç¤ºï¼Ÿ
   - é”™è¯¯å‘ç”Ÿåœ¨å“ªé‡Œï¼Ÿ

4. **è¯†åˆ«æ ¹æœ¬åŸå› **
   - ç¼ºå°‘å·¥å…·é…ç½®ï¼Ÿ
   - æç¤ºæŒ‡ä»¤ä¸æ­£ç¡®ï¼Ÿ
   - API é”™è¯¯ï¼Ÿ
   - å·¥å…·å‚æ•°ä¸åŒ¹é…ï¼Ÿ

5. **ä¿®å¤å’ŒéªŒè¯**
   - æ›´æ–°ä»£ç†å®šä¹‰
   - ä½¿ç”¨ç›¸åŒè¾“å…¥é‡æ–°è¿è¡Œ
   - ç¡®è®¤ä¿®å¤æœ‰æ•ˆ
   - æ·»åŠ æµ‹è¯•ç”¨ä¾‹ä»¥é˜²æ­¢å›å½’

## å­¦ä¹ èµ„æº

### ADK æ–‡æ¡£
- [å¯è§‚æµ‹æ€§æ¦‚è¿°](https://google.github.io/adk-docs/observability/logging/)
- [è‡ªå®šä¹‰æ’ä»¶](https://google.github.io/adk-docs/plugins/)
- [Cloud Trace é›†æˆ](https://google.github.io/adk-docs/observability/cloud-trace/)
- [è¯„ä¼°æ¦‚è¿°](https://google.github.io/adk-docs/evaluate/)
- [è¯„ä¼°æ ‡å‡†](https://google.github.io/adk-docs/evaluate/criteria/)
- [ç”¨æˆ·æ¨¡æ‹Ÿ](https://google.github.io/adk-docs/evaluate/user-sim/)

### é«˜çº§ä¸»é¢˜
- [åŸºäº Pytest çš„è¯„ä¼°](https://google.github.io/adk-docs/evaluate/#2-pytest-run-tests-programmatically)
- [Vertex AI è¯„ä¼°æŒ‡æ ‡](https://docs.cloud.google.com/vertex-ai/generative-ai/docs/models/determine-eval)

## ä¸‹ä¸€æ­¥

å®Œæˆç¬¬4å¤©åï¼Œæ‚¨å·²ç»å­¦åˆ°ï¼š
- âœ… å¦‚ä½•ä½¿ç”¨å¯è§‚æµ‹æ€§å·¥å…·è°ƒè¯•ä»£ç†
- âœ… ä½¿ç”¨ LoggingPlugin è¿›è¡Œç”Ÿäº§ç›‘æ§
- âœ… åˆ›å»ºè‡ªå®šä¹‰æ’ä»¶ä»¥æ»¡è¶³ç‰¹æ®Šéœ€æ±‚
- âœ… æ„å»ºå…¨é¢çš„æµ‹è¯•å¥—ä»¶
- âœ… è¿è¡Œç³»ç»Ÿæ€§è¯„ä¼°
- âœ… åˆ†æå’Œä¿®å¤è¯„ä¼°å¤±è´¥

**ç»§ç»­ç¬¬5å¤©**ä»¥å­¦ä¹ ï¼š
- å°†ä»£ç†éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
- Agent2Agent åè®®
- æ‰©å±•è€ƒè™‘å› ç´ 
- ç”Ÿäº§æœ€ä½³å®è·µ

**ç»ƒä¹ é¢˜ï¼š**
1. å°† LoggingPlugin æ·»åŠ åˆ°æ‚¨çš„ç¬¬3å¤©å†…å­˜ä»£ç†
2. ä¸ºæ‚¨ç°æœ‰çš„ä»£ç†åˆ›å»ºè¯„ä¼°æµ‹è¯•å¥—ä»¶
3. æ„å»ºè‡ªå®šä¹‰æ’ä»¶ä»¥è·Ÿè¸ªä»¤ç‰Œä½¿ç”¨æˆæœ¬
4. ä¸ºæ‚¨çš„ç”¨ä¾‹å®ç°ç”¨æˆ·æ¨¡æ‹Ÿ
5. å°†è¯„ä¼°é›†æˆåˆ° CI/CD å·¥ä½œæµç¨‹ä¸­

ç¥è°ƒè¯•å’Œæµ‹è¯•æ„‰å¿«ï¼ğŸ”âœ…
