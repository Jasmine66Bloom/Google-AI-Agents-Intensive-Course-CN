================================================================================
  Day 2b: 智能体工具最佳实践
================================================================================
✅ 已从 .env 文件加载 Gemini API key。

📚 高级模式：
1. MCP 集成 - 连接到外部服务
2. 长时间运行的操作 - 人工参与审批
3. 可恢复工作流 - 通过状态管理暂停和恢复

--- 模型上下文协议 (MCP) ---

📡 什么是 MCP？

MCP 是一个开放标准，让智能体能够连接到外部服务
而无需编写自定义集成代码。

架构：
    ┌──────────────────┐
    │   你的智能体     │
    │   (MCP 客户端)   │
    └────────┬─────────┘
             │
             │ 标准 MCP 协议
             │
        ┌────┴────┬────────┬────────┐
        │         │        │        │
        ▼         ▼        ▼        ▼
    ┌────────┐ ┌─────┐ ┌──────┐ ┌─────┐
    │ GitHub │ │Slack│ │ Maps │ │ ... │
    │ 服务器 │ │ MCP │ │ MCP  │ │     │
    └────────┘ └─────┘ └──────┘ └─────┘

如何在 ADK 中使用 MCP：

1. 安装 MCP 服务器（例如，通过 npx）
2. 使用连接参数创建 McpToolset
3. 将工具集添加到你的智能体
4. 智体现在可以使用 MCP 工具了！

示例（需要 Node.js）：
    from google.adk.tools.mcp_tool.mcp_toolset import McpToolset
    from mcp import StdioServerParameters

    mcp_server = McpToolset(
        connection_params=StdioConnectionParams(
            server_params=StdioServerParameters(
                command="npx",
                args=["-y", "@modelcontextprotocol/server-everything"],
                tool_filter=["getTinyImage"],
            ),
            timeout=30,
        )
    )

    agent = LlmAgent(
        model=Gemini(...),
        tools=[mcp_server],  # 将 MCP 工具添加到智能体
    )

可用的 MCP 服务器：
- Kaggle：数据集和笔记本操作
- GitHub：仓库和 PR/issue 管理
- Google Maps：位置和方向
- Slack：团队通信
- 更多请访问：modelcontextprotocol.io/examples


✅ MCP 概念已解释


================================================================================
  示例：长时间运行的操作（人工参与）
================================================================================

--- 正在创建长时间运行操作系统 ---
/Users/benogren/Desktop/projects/AI-Agents-Intensive-Course/Day-2/day_2b_agent_tools_best_practices.py:213: UserWarning: [实验性] ResumabilityConfig：此功能是实验性的，可能会在未来版本中更改或移除，恕不另行通知。它可能随时引入重大更改。
  resumability_config=ResumabilityConfig(is_resumable=True),
✅ 已创建可恢复的运输系统
🔧 功能：
  • 自动批准小订单（≤5 个集装箱）
  • 大订单暂停等待审批（>5 个集装箱）
  • 在暂停/恢复期间保持状态

📋 测试三个场景：

1️⃣ 小订单（3 个集装箱）- 自动批准：

============================================================
用户 > 将 3 个集装箱运送到新加坡

警告：响应中包含非文本部分：['function_call']，正在从文本部分返回连接的文本结果。检查完整的 candidates.content.parts 访问器以获取完整的模型响应。
智能体 > 运输订单已批准。订单 ID：ORD-3-AUTO。3 个集装箱将被运送到新加坡。
============================================================

2️⃣ 大订单（10 个集装箱）- 需要审批 - 批准：

============================================================
用户 > 将 10 个集装箱运送到鹿特丹

警告：响应中包含非文本部分：['function_call']，正在从文本部分返回连接的文本结果。检查完整的 candidates.content.parts 访问器以获取完整的模型响应。
/Users/benogren/Desktop/projects/AI-Agents-Intensive-Course/venv/lib/python3.14/site-packages/google/adk/tools/tool_context.py:92: UserWarning: [实验性] ToolConfirmation：此功能是实验性的，可能会在未来版本中更改或移除，恕不另行通知。它可能随时引入重大更改。
  ToolConfirmation(
⏸️  暂停等待审批...
🤔 人工决策：批准 ✅

/Users/benogren/Desktop/projects/AI-Agents-Intensive-Course/venv/lib/python3.14/site-packages/google/adk/agents/invocation_context.py:298: UserWarning: [实验性] BaseAgentState：此功能是实验性的，可能会在未来版本中更改或移除，恕不另行通知。它可能随时引入重大更改。
  self.agent_states[event.author] = BaseAgentState()
智能体 > 运输订单已批准：10 个集装箱运送到鹿特丹。订单 ID 为 ORD-10-HUMAN。
============================================================

3️⃣ 大订单（8 个集装箱）- 需要审批 - 拒绝：

============================================================
用户 > 将 8 个集装箱运送到洛杉矶

警告：响应中包含非文本部分：['function_call']，正在从文本部分返回连接的文本结果。检查完整的 candidates.content.parts 访问器以获取完整的模型响应。
⏸️  暂停等待审批...
🤔 人工决策：拒绝 ❌

智能体 > 您将 8 个集装箱运送到洛杉矶的运输订单已被拒绝。
============================================================

✅ 所有的长时间运行操作场景已完成！

================================================================================
  ✅ 所有示例已完成！
================================================================================

📖 关键要点：
- MCP：连接到外部服务而无需自定义集成
- LRO：暂停工作流以进行人工审批或长时间运行的任务
- 可恢复性：在对话中断期间保持状态
- 工具上下文：访问审批状态并请求确认

🔑 何时使用每种模式：
┌───────────────────────┬──────────────────────────────────────────┐
│ 模式                   │ 用例                                      │
├───────────────────────┼──────────────────────────────────────────┤
│ MCP 集成               │ 连接到外部、标准化的                      │
│                       │ 服务（GitHub、数据库等）                  │
├───────────────────────┼──────────────────────────────────────────┤
│ 长时间运行的操作       │ 人工审批、合规检查，                      │
│                       │ 或跨越时间的操作                          │
└───────────────────────┴──────────────────────────────────────────┘

🎯 下一步：第 3 天将涵盖状态和内存管理！
